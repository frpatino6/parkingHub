# ParkingHub â€” AI Agent Rules
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# This file is the MASTER configuration for all AI coding assistants.
# All agents MUST read and follow these rules before writing any code.
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âš ï¸ MANDATORY: Read Reference Manuals Before Coding

Before writing ANY code, you MUST consult these manuals in `.agent-skills/`:
- `project-context.md` â€” MVP scope (Check-in/out, Pricing, Cash Cut), Vision.
- `angular-expert.md` â€” Angular 19+, **BLoC pattern**, signals, control flow.
- `node-best-practices.md` â€” Node.js/Express, **Pricing Engine (Backend Only)**, JWT.
- `mongodb-optimization.md` â€” Schema design, multi-tenant isolation, **AuditLogs**.
- `clean-architecture-patterns.md` â€” Layers, DI, **Strict Decoupling**.
- `professional-web-design.md` â€” Design tokens, accessibility, dark mode.

---

## ğŸŒ Multi-Tenant & Branch Enforcement

### Strict Isolation
- **ALL** queries and mutations MUST include `tenantId`.
- **ALL** branch-specific data MUST include `branchId`.
- **tenantId** MUST be extracted from the JWT token. NEVER trust it from request bodies.
- **Tenant Context**: Use the `TenantContext` (AsyncLocalStorage) pattern.

---

## ğŸ’ Project Patterns (ParkingHub Strict)

### Naming Conventions (PascalCase Files)
- **ALL** class-based files MUST use `PascalCase`.
  - âœ… `RegisterCheckIn.UseCase.ts`
  - âœ… `ParkingList.Bloc.ts`
  - âœ… `User.Entity.ts`
- **Variables & Functions**: `camelCase`.

### Pricing Engine
- **MANDATORY**: All pricing calculations must occur in the **Backend**.
- Frontend only displays results; it never calculates totals, fractions, or grace periods.

### Security
- **RBAC Roles**: `SUPER_ADMIN`, `PARKING_ADMIN`, `OPERATOR`.

### Audit Logs
- Every critical action (manual opening, cancellation, price override) MUST be logged in `AuditLogs`.

---

## Architecture Enforcement

### Clean Architecture â€” STRICT
- **ZERO** framework dependencies in the Domain layer.
- **Use Case Isolation**: Use Cases must not know MongoDB or Express exist.
- **Dependency Inversion**: Use interfaces (ports) for repositories.

---

## Frontend Standards (Angular 19+)

- **State Management**: Use the **BLoC** pattern.
- **Standalone components ONLY**.
- **ChangeDetectionStrategy.OnPush** on ALL components.
- **Signals** for state; **RxJS** for async streams.
- **New control flow**: `@if`, `@for`, `@switch`.

---

## Code Quality

- **ESLint** + **Prettier**.
- **No `console.log`** â€” use the project logger.
- **No `any` type**.
- **File naming**: `PascalCase` matching the class/component name.
- **One export per file**.
- **Tests required** for Use Cases and Entities.

---

## Node.js Version (nvm-windows)
- Project requires **Node 20+**. Use wrapper: `scripts\use-node20.cmd <command>` (PATH not updated by `nvm use` in same shell).
- See `.nvmrc` and `CLAUDE.md` for details.

---

## Commit Messages (Conventional Commits)
- Format: `<type>(<scope>): <description>`
- Scopes: `frontend`, `backend`, `shared`, `db`, `infra`, `docs`.
