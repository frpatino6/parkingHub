<main class="check-in-page">
  <div class="check-in-container">
    <header class="page-header">
      <h1 class="page-title">Registro de Ingreso</h1>
      <p class="page-subtitle">Captura la placa y tipo de vehículo para generar el ticket</p>
    </header>

    @if (bloc.isSuccess()) {
      <section class="success-card stagger-item">
        <div class="success-icon">✓</div>
        <h2 class="success-title">Ingreso registrado</h2>
        <p class="success-plate">{{ bloc.result()!.plate }}</p>
        <p class="success-meta">{{ bloc.result()!.vehicleType }} · {{ formatCheckInDate(bloc.result()!.checkIn) }}</p>

        <div class="qr-wrapper">
          <img [src]="bloc.result()!.qrImageDataUrl" alt="Código QR del ticket" class="qr-image" />
        </div>

        <p class="ticket-id">Ticket #{{ bloc.result()!.ticketId.slice(0, 8) }}</p>

        <button type="button" class="btn btn--primary" (click)="onNewCheckIn()">
          Nuevo ingreso
        </button>
      </section>
    } @else {
      <form class="check-in-form stagger-item" [formGroup]="form" (ngSubmit)="onSubmit()">
        @if (bloc.error()) {
          <div class="error-banner" role="alert">
            {{ bloc.error() }}
          </div>
        }

        <div class="form-group">
          <label for="plate" class="form-label">Placa</label>
          <input
            id="plate"
            type="text"
            class="form-input"
            formControlName="plate"
            placeholder="ABC123"
            maxlength="10"
            autocomplete="off"
            [attr.aria-invalid]="form.get('plate')?.invalid && form.get('plate')?.touched"
          />
          @if (form.get('plate')?.invalid && form.get('plate')?.touched) {
            <span class="form-error">La placa es obligatoria</span>
          }
        </div>

        <div class="form-group">
          <label for="vehicleType" class="form-label">Tipo de vehículo</label>
          <select id="vehicleType" class="form-select" formControlName="vehicleType">
            @for (opt of vehicleTypeOptions; track opt.value) {
              <option [value]="opt.value">{{ opt.label }}</option>
            }
          </select>
        </div>

        <button
          type="submit"
          class="btn btn--primary btn--full"
          [disabled]="bloc.isSubmitting() || form.invalid"
        >
          @if (bloc.isSubmitting()) {
            <span class="btn-spinner"></span>
            Registrando…
          } @else {
            Registrar ingreso
          }
        </button>
      </form>
    }
  </div>
</main>
